# May 2025 TIL (Today I Learned)

This file contains things I learned during May 2025.

---

## 2025-05-12: TanStack Query / SWRが導入されていないプロジェクトでの場当たり的なAPIリクエスト競合状態の回避法

TanStack Query /
SWRの本質は、ドキュメントにも書いてあるけど、データフェッチライブラリではなく、非同期な状態管理ライブラリである。

当該ライブラリたちの、いわゆる"sane defaults"により、APIなどの非同期な状態のハンドリングがカバーされる認識だ。

ただ、プロジェクトによっては、TanStack Query /
SWRが導入されていない場合もあので、そういった場合の、場当たり的なAPIリクエストの競合状態を回避する方法をメモしておく。

下記のサンプルの前提としては、React Routerが導入されていることだが、別にVanilla JSでも同じようなことができる。

```ts
import { matchPath } from 'react-router';
import { z } from 'zod';
import { isValid, parse } from 'date-fns;

const yearMonthParamSchema = z.string().refine((val) => {
  const parsedDate = parse(val, 'yyyy-MM', new Date());
  return isValid(parsedDate);
}, {
  message: 'Invalid yearMonth format',
});

// `/page-name/2025-05`のパスの例
const getCurrentSelectedYearMonthParam = () => {
  const pathMatch = matchPath(
    `page-name/:selectedYearMonth`,
  );
  if (pathMatch === null) {
    return
  }

  const currentSelectedYearMonthParam = yearMonthParamSchema.safeParse(
    pathMatch.params.selectedYearMonth,
  )
  if (!currentSelectedYearMonthParam.success) {
    return
  }

  return currentSelectedYearMonthParam.data;
}

export const fetchData = async (params: { yearMonth: string }) => {
  const response = await fetch(`/api/v1/collection?yearMonth=${params.yearMonth}`);

  if (isHttpError(response)) {
    // APIリクエストのエラーハンドリング
    handleHttpError(response);
    return
  }

  const data = await response.json();

  const currentSelectedYearMonthParam = getCurrentSelectedYearMonthParam();
  if (typeof currentSelectedYearMonthParam === 'undefined' ||
    currentSelectedYearMonthParam !== params.yearMonth) {
    // 競合状態を回避するために、APIリクエストの結果を無視する
    return
  }

  return data;
}
```

- レースコンディション
- ウォーターフォール問題

などを、根本解決するものではないが、場当たり的なAPIリクエストの競合状態を回避する方法としては、十分に機能する。

---

## 2025-05-11: ClineをGitHub Copilot Proの有料プランで使う

### そもそもClineとは

- Clineは、オープンソースのAIエージェントで、コードを生成したり、質問に答えたりすることができる。
- カスタマイズ性が高く、あらゆるモデル、エディタ、プロンプト、カスタムフォークを使用できる。
- エクステンションなので、あらゆるエディタに対応しているところが、Cursor, Windsurf, Bolt.newなどとの違いである。

参考）

- <https://cline.bot/>
- <https://youtu.be/TFU33etuKb0?si=VYo2BY7UJXtd9hCI>

### できるだけ安価でAI agentを使うために

最初のフリープランで使える、API Provider: `OpenRouter` / Language Model: `claude-3.7-sonnet`
でのクレジットを既に使い切ってしまっていた。

もともと[GitHub Copilot Pro](https://github.com/features/copilot)
(年100ドル) は導入していたので、その管轄内でClineを使うことにした。

API Provider: `VS Code LM API` / Language Model: `copilot - gpt-4.1`にして、Plan
modeの方を選択したら、わりと通信量を絞ることができて、安価に使えるようになった。

GitHub Copilot ProのAgent modeとも比較しながら使ってみようと思う。

参考）

- <https://qiita.com/generokenken/items/ef761c49a8d23336642c>

---

## 2025-05-10: バージョン管理と時間管理

### バージョン管理

今までバージョン管理ツールは[asdf](https://asdf-vm.com/)を使っていたが、[mise](https://github.com/jdx/mise)というイケてるバージョンツールがあることを知った。

Figmaの人が作者で、スポンサーも多くついているし、何よりasdfみたいなプラグインの別管理が不要そうなのがよさそう。

早速、miseに乗り換えてみた。

注意点としては、下記のようにmiseを有効化するためのコマンドをシェルの初期化ファイルに追加する必要がある。

```sh
# See https://mise.jdx.dev/cli/activate.html
echo 'eval "$(mise activate zsh)"' >> ~/.zshrc
```

### 時間管理

時間管理ができるには、脳の「実行機能」がうまく働く必要があり、以下の４つのステップを踏む必要があるそう。

1. まずは「スタートする」
1. 次に「計画を立てる」
1. 時計などを見ながら「進捗をモニタリングする」
1. 最後に「脱線を防止する」

この４つのステップがうまくできないと、時間管理ができないらしい。

参考）朝日新聞 be on Saturday 2025年5月10日号

---

## 2025-05-09: [Topic Title]

[Description of what you learned today]

### Example/Code (if applicable)

```txt
# Code example here
```

### References

- [Reference link 1](https://example.com)
- [Reference link 2](https://example.com)

---

<!-- Template for new entries -->
<!--
## 2025-05-XX: [Topic Title]

[Description of what you learned today]

### Example/Code (if applicable)

```txt
# Code example here
```

### References

- [Reference link 1](https://example.com)
- [Reference link 2](https://example.com)
-->
